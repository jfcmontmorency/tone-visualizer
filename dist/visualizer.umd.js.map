{"version":3,"file":"visualizer.umd.js","sources":["../src/visualizer.js"],"sourcesContent":["import p5 from 'p5';\nimport * as Tone from \"tone.js\";\n\n// Classe ToneVisualizer\nexport class ToneVisualizer {\n  constructor(element, audioSource, config = {}) {\n    // Récupération de l'élément via querySelector\n    this.element = typeof element === 'string' \n      ? document.querySelector(element)\n      : element;\n\n    if (!this.element) {\n      throw new Error(`Element \"${element}\" not found`);\n    }\n\n    // Configuration par défaut (100% de l'élément parent)\n    const {\n      width = this.element.offsetWidth || this.element.clientWidth || 1000,\n      height = this.element.offsetHeight || this.element.clientHeight || 150,\n      type = 'fft',\n      fftSize = 1024,\n      waveformSize = 512,\n      fillColor = [0, 255, 255, 200],\n      strokeColor = [0, 255, 255],\n      strokeWeight = 2\n    } = config;\n    \n    this.audioSource = audioSource;\n    this.width = width;\n    this.height = height;\n    this.type = type;\n    this.fillColor = fillColor;\n    this.strokeColor = strokeColor;\n    this.strokeWeight = strokeWeight;\n    this.started = false;\n\n    // Initialisation des analyseurs\n    this.fftAnalyzer = new Tone.FFT(fftSize);\n    this.waveform = new Tone.Waveform(waveformSize);\n\n    // Connexion de la source audio aux analyseurs\n    this.audioSource.connect(this.fftAnalyzer).connect(this.waveform);\n\n    // Gestion du resize\n    this._setupResizeObserver();\n\n    // Initialisation du canvas p5\n    this._initP5();\n  }\n\n  _setupResizeObserver() {\n    if (typeof ResizeObserver !== 'undefined') {\n      this.resizeObserver = new ResizeObserver(() => {\n        const newWidth = this.element.offsetWidth || this.element.clientWidth;\n        const newHeight = this.element.offsetHeight || this.element.clientHeight;\n        \n        if (newWidth !== this.width || newHeight !== this.height) {\n          this.width = newWidth;\n          this.height = newHeight;\n          if (this.p5Instance) {\n            this.p5Instance.resizeCanvas(newWidth, newHeight);\n          }\n        }\n      });\n      this.resizeObserver.observe(this.element);\n    }\n  }\n\n  _initP5() {\n    this.p5Instance = new p5((p) => {\n      p.setup = () => {\n        const canvas = p.createCanvas(this.width, this.height);\n        canvas.parent(this.element.id || this.element);\n        canvas.elt.style.background = \"transparent\";\n      };\n\n      p.draw = () => {\n        p.clear();\n\n        if (!this.started) return;\n\n        if (this.type === 'fft') {\n          this._drawFFT(p);\n        } else if (this.type === 'oscilloscope') {\n          this._drawOscilloscope(p);\n        }\n      };\n    }, this.element.id || this.element);\n  }\n\n  _drawFFT(p) {\n    p.noStroke();\n    p.fill(...this.fillColor);\n\n    const spectrum = this.fftAnalyzer.getValue();\n    const len = spectrum.length;\n    const bw = p.width / len;\n\n    for (let i = 0; i < len; i++) {\n      const db = spectrum[i];\n      const h = p.map(db, -140, 0, 0, p.height);\n      p.rect(i * bw, p.height - h, bw + 1, h);\n    }\n  }\n\n  _drawOscilloscope(p) {\n    p.noFill();\n    p.strokeWeight(this.strokeWeight);\n    p.stroke(...this.strokeColor);\n\n    const values = this.waveform.getValue();\n    p.beginShape();\n    for (let i = 0; i < values.length; i++) {\n      const x = p.map(i, 0, values.length, 0, p.width);\n      const y = p.map(values[i], -1, 1, 0, p.height);\n      p.vertex(x, y);\n    }\n    p.endShape();\n  }\n\n  start() {\n    this.started = true;\n  }\n\n  stop() {\n    this.started = false;\n  }\n\n  setType(type) {\n    this.type = type;\n  }\n\n  setFillColor(color) {\n    this.fillColor = color;\n  }\n\n  setStrokeColor(color) {\n    this.strokeColor = color;\n  }\n\n  setStrokeWeight(weight) {\n    this.strokeWeight = weight;\n  }\n\n  destroy() {\n    this.stop();\n    if (this.resizeObserver) {\n      this.resizeObserver.disconnect();\n    }\n    if (this.p5Instance) {\n      this.p5Instance.remove();\n    }\n    this.audioSource.disconnect(this.fftAnalyzer);\n    this.audioSource.disconnect(this.waveform);\n  }\n}\n"],"names":["Tone"],"mappings":"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"}