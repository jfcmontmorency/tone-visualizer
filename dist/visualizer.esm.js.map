{"version":3,"file":"visualizer.esm.js","sources":["../src/visualizer.js"],"sourcesContent":["import p5 from 'p5';\nimport * as Tone from \"tone.js\";\n\n// Classe ToneVisualizer\nexport class ToneVisualizer {\n  constructor(element, audioSource, config = {}) {\n    // Récupération de l'élément via querySelector\n    this.element = typeof element === 'string' \n      ? document.querySelector(element)\n      : element;\n\n    if (!this.element) {\n      throw new Error(`Element \"${element}\" not found`);\n    }\n\n    // Configuration par défaut (100% de l'élément parent)\n    const {\n      width = this.element.offsetWidth || this.element.clientWidth || 1000,\n      height = this.element.offsetHeight || this.element.clientHeight || 150,\n      type = 'fft',\n      fftSize = 1024,\n      waveformSize = 512,\n      fillColor = [0, 255, 255, 200],\n      strokeColor = [0, 255, 255],\n      strokeWeight = 2\n    } = config;\n    \n    this.audioSource = audioSource;\n    this.width = width;\n    this.height = height;\n    this.type = type;\n    this.fillColor = fillColor;\n    this.strokeColor = strokeColor;\n    this.strokeWeight = strokeWeight;\n    this.started = false;\n\n    // Initialisation des analyseurs\n    this.fftAnalyzer = new Tone.FFT(fftSize);\n    this.waveform = new Tone.Waveform(waveformSize);\n\n    // Connexion de la source audio aux analyseurs\n    this.audioSource.connect(this.fftAnalyzer).connect(this.waveform);\n\n    // Gestion du resize\n    this._setupResizeObserver();\n\n    // Initialisation du canvas p5\n    this._initP5();\n  }\n\n  _setupResizeObserver() {\n    if (typeof ResizeObserver !== 'undefined') {\n      this.resizeObserver = new ResizeObserver(() => {\n        const newWidth = this.element.offsetWidth || this.element.clientWidth;\n        const newHeight = this.element.offsetHeight || this.element.clientHeight;\n        \n        if (newWidth !== this.width || newHeight !== this.height) {\n          this.width = newWidth;\n          this.height = newHeight;\n          if (this.p5Instance) {\n            this.p5Instance.resizeCanvas(newWidth, newHeight);\n          }\n        }\n      });\n      this.resizeObserver.observe(this.element);\n    }\n  }\n\n  _initP5() {\n    this.p5Instance = new p5((p) => {\n      p.setup = () => {\n        const canvas = p.createCanvas(this.width, this.height);\n        canvas.parent(this.element.id || this.element);\n        canvas.elt.style.background = \"transparent\";\n      };\n\n      p.draw = () => {\n        p.clear();\n\n        if (!this.started) return;\n\n        if (this.type === 'fft') {\n          this._drawFFT(p);\n        } else if (this.type === 'oscilloscope') {\n          this._drawOscilloscope(p);\n        }\n      };\n    }, this.element.id || this.element);\n  }\n\n  _drawFFT(p) {\n    p.noStroke();\n    p.fill(...this.fillColor);\n\n    const spectrum = this.fftAnalyzer.getValue();\n    const len = spectrum.length;\n    const bw = p.width / len;\n\n    for (let i = 0; i < len; i++) {\n      const db = spectrum[i];\n      const h = p.map(db, -140, 0, 0, p.height);\n      p.rect(i * bw, p.height - h, bw + 1, h);\n    }\n  }\n\n  _drawOscilloscope(p) {\n    p.noFill();\n    p.strokeWeight(this.strokeWeight);\n    p.stroke(...this.strokeColor);\n\n    const values = this.waveform.getValue();\n    p.beginShape();\n    for (let i = 0; i < values.length; i++) {\n      const x = p.map(i, 0, values.length, 0, p.width);\n      const y = p.map(values[i], -1, 1, 0, p.height);\n      p.vertex(x, y);\n    }\n    p.endShape();\n  }\n\n  start() {\n    this.started = true;\n  }\n\n  stop() {\n    this.started = false;\n  }\n\n  setType(type) {\n    this.type = type;\n  }\n\n  setFillColor(color) {\n    this.fillColor = color;\n  }\n\n  setStrokeColor(color) {\n    this.strokeColor = color;\n  }\n\n  setStrokeWeight(weight) {\n    this.strokeWeight = weight;\n  }\n\n  destroy() {\n    this.stop();\n    if (this.resizeObserver) {\n      this.resizeObserver.disconnect();\n    }\n    if (this.p5Instance) {\n      this.p5Instance.remove();\n    }\n    this.audioSource.disconnect(this.fftAnalyzer);\n    this.audioSource.disconnect(this.waveform);\n  }\n}\n"],"names":[],"mappings":";;;AAGA;AACO,MAAM,cAAc,CAAC;AAC5B,EAAE,WAAW,CAAC,OAAO,EAAE,WAAW,EAAE,MAAM,GAAG,EAAE,EAAE;AACjD;AACA,IAAI,IAAI,CAAC,OAAO,GAAG,OAAO,OAAO,KAAK,QAAQ;AAC9C,QAAQ,QAAQ,CAAC,aAAa,CAAC,OAAO;AACtC,QAAQ,OAAO;;AAEf,IAAI,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;AACvB,MAAM,MAAM,IAAI,KAAK,CAAC,CAAC,SAAS,EAAE,OAAO,CAAC,WAAW,CAAC,CAAC;AACvD,IAAI;;AAEJ;AACA,IAAI,MAAM;AACV,MAAM,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,WAAW,IAAI,IAAI,CAAC,OAAO,CAAC,WAAW,IAAI,IAAI;AAC1E,MAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,YAAY,IAAI,IAAI,CAAC,OAAO,CAAC,YAAY,IAAI,GAAG;AAC5E,MAAM,IAAI,GAAG,KAAK;AAClB,MAAM,OAAO,GAAG,IAAI;AACpB,MAAM,YAAY,GAAG,GAAG;AACxB,MAAM,SAAS,GAAG,CAAC,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC;AACpC,MAAM,WAAW,GAAG,CAAC,CAAC,EAAE,GAAG,EAAE,GAAG,CAAC;AACjC,MAAM,YAAY,GAAG;AACrB,KAAK,GAAG,MAAM;AACd;AACA,IAAI,IAAI,CAAC,WAAW,GAAG,WAAW;AAClC,IAAI,IAAI,CAAC,KAAK,GAAG,KAAK;AACtB,IAAI,IAAI,CAAC,MAAM,GAAG,MAAM;AACxB,IAAI,IAAI,CAAC,IAAI,GAAG,IAAI;AACpB,IAAI,IAAI,CAAC,SAAS,GAAG,SAAS;AAC9B,IAAI,IAAI,CAAC,WAAW,GAAG,WAAW;AAClC,IAAI,IAAI,CAAC,YAAY,GAAG,YAAY;AACpC,IAAI,IAAI,CAAC,OAAO,GAAG,KAAK;;AAExB;AACA,IAAI,IAAI,CAAC,WAAW,GAAG,IAAI,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC;AAC5C,IAAI,IAAI,CAAC,QAAQ,GAAG,IAAI,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC;;AAEnD;AACA,IAAI,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC;;AAErE;AACA,IAAI,IAAI,CAAC,oBAAoB,EAAE;;AAE/B;AACA,IAAI,IAAI,CAAC,OAAO,EAAE;AAClB,EAAE;;AAEF,EAAE,oBAAoB,GAAG;AACzB,IAAI,IAAI,OAAO,cAAc,KAAK,WAAW,EAAE;AAC/C,MAAM,IAAI,CAAC,cAAc,GAAG,IAAI,cAAc,CAAC,MAAM;AACrD,QAAQ,MAAM,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,WAAW,IAAI,IAAI,CAAC,OAAO,CAAC,WAAW;AAC7E,QAAQ,MAAM,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,YAAY,IAAI,IAAI,CAAC,OAAO,CAAC,YAAY;AAChF;AACA,QAAQ,IAAI,QAAQ,KAAK,IAAI,CAAC,KAAK,IAAI,SAAS,KAAK,IAAI,CAAC,MAAM,EAAE;AAClE,UAAU,IAAI,CAAC,KAAK,GAAG,QAAQ;AAC/B,UAAU,IAAI,CAAC,MAAM,GAAG,SAAS;AACjC,UAAU,IAAI,IAAI,CAAC,UAAU,EAAE;AAC/B,YAAY,IAAI,CAAC,UAAU,CAAC,YAAY,CAAC,QAAQ,EAAE,SAAS,CAAC;AAC7D,UAAU;AACV,QAAQ;AACR,MAAM,CAAC,CAAC;AACR,MAAM,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC;AAC/C,IAAI;AACJ,EAAE;;AAEF,EAAE,OAAO,GAAG;AACZ,IAAI,IAAI,CAAC,UAAU,GAAG,IAAI,EAAE,CAAC,CAAC,CAAC,KAAK;AACpC,MAAM,CAAC,CAAC,KAAK,GAAG,MAAM;AACtB,QAAQ,MAAM,MAAM,GAAG,CAAC,CAAC,YAAY,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC;AAC9D,QAAQ,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,IAAI,IAAI,CAAC,OAAO,CAAC;AACtD,QAAQ,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,UAAU,GAAG,aAAa;AACnD,MAAM,CAAC;;AAEP,MAAM,CAAC,CAAC,IAAI,GAAG,MAAM;AACrB,QAAQ,CAAC,CAAC,KAAK,EAAE;;AAEjB,QAAQ,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;;AAE3B,QAAQ,IAAI,IAAI,CAAC,IAAI,KAAK,KAAK,EAAE;AACjC,UAAU,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;AAC1B,QAAQ,CAAC,MAAM,IAAI,IAAI,CAAC,IAAI,KAAK,cAAc,EAAE;AACjD,UAAU,IAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC;AACnC,QAAQ;AACR,MAAM,CAAC;AACP,IAAI,CAAC,EAAE,IAAI,CAAC,OAAO,CAAC,EAAE,IAAI,IAAI,CAAC,OAAO,CAAC;AACvC,EAAE;;AAEF,EAAE,QAAQ,CAAC,CAAC,EAAE;AACd,IAAI,CAAC,CAAC,QAAQ,EAAE;AAChB,IAAI,CAAC,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC;;AAE7B,IAAI,MAAM,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAC,QAAQ,EAAE;AAChD,IAAI,MAAM,GAAG,GAAG,QAAQ,CAAC,MAAM;AAC/B,IAAI,MAAM,EAAE,GAAG,CAAC,CAAC,KAAK,GAAG,GAAG;;AAE5B,IAAI,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,EAAE;AAClC,MAAM,MAAM,EAAE,GAAG,QAAQ,CAAC,CAAC,CAAC;AAC5B,MAAM,MAAM,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,EAAE,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC;AAC/C,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC,MAAM,GAAG,CAAC,EAAE,EAAE,GAAG,CAAC,EAAE,CAAC,CAAC;AAC7C,IAAI;AACJ,EAAE;;AAEF,EAAE,iBAAiB,CAAC,CAAC,EAAE;AACvB,IAAI,CAAC,CAAC,MAAM,EAAE;AACd,IAAI,CAAC,CAAC,YAAY,CAAC,IAAI,CAAC,YAAY,CAAC;AACrC,IAAI,CAAC,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC;;AAEjC,IAAI,MAAM,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE;AAC3C,IAAI,CAAC,CAAC,UAAU,EAAE;AAClB,IAAI,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AAC5C,MAAM,MAAM,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC;AACtD,MAAM,MAAM,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,MAAM,CAAC;AACpD,MAAM,CAAC,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC;AACpB,IAAI;AACJ,IAAI,CAAC,CAAC,QAAQ,EAAE;AAChB,EAAE;;AAEF,EAAE,KAAK,GAAG;AACV,IAAI,IAAI,CAAC,OAAO,GAAG,IAAI;AACvB,EAAE;;AAEF,EAAE,IAAI,GAAG;AACT,IAAI,IAAI,CAAC,OAAO,GAAG,KAAK;AACxB,EAAE;;AAEF,EAAE,OAAO,CAAC,IAAI,EAAE;AAChB,IAAI,IAAI,CAAC,IAAI,GAAG,IAAI;AACpB,EAAE;;AAEF,EAAE,YAAY,CAAC,KAAK,EAAE;AACtB,IAAI,IAAI,CAAC,SAAS,GAAG,KAAK;AAC1B,EAAE;;AAEF,EAAE,cAAc,CAAC,KAAK,EAAE;AACxB,IAAI,IAAI,CAAC,WAAW,GAAG,KAAK;AAC5B,EAAE;;AAEF,EAAE,eAAe,CAAC,MAAM,EAAE;AAC1B,IAAI,IAAI,CAAC,YAAY,GAAG,MAAM;AAC9B,EAAE;;AAEF,EAAE,OAAO,GAAG;AACZ,IAAI,IAAI,CAAC,IAAI,EAAE;AACf,IAAI,IAAI,IAAI,CAAC,cAAc,EAAE;AAC7B,MAAM,IAAI,CAAC,cAAc,CAAC,UAAU,EAAE;AACtC,IAAI;AACJ,IAAI,IAAI,IAAI,CAAC,UAAU,EAAE;AACzB,MAAM,IAAI,CAAC,UAAU,CAAC,MAAM,EAAE;AAC9B,IAAI;AACJ,IAAI,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,IAAI,CAAC,WAAW,CAAC;AACjD,IAAI,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC;AAC9C,EAAE;AACF;;;;"}